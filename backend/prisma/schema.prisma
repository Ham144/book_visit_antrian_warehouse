generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Subscription {
  id            String @id @default(uuid())
  start DateTime
  plan SubscriptionPlan @default(TRIAL)
  organizationId String? @unique
  organizations Organization? @relation(fields: [organizationId], references: [name]) 
} 

model Organization { 
  name String @id @unique
  subscriptionId String? @unique
  subscription Subscription?
  AD_HOST String?
  AD_PORT String?
  AD_DOMAIN String?
  AD_BASE_DN String?
  warehouses Warehouse[]
  docks Dock[]
  vehicles Vehicle[]
  bookings Booking[]
}

model Globalsetting {//ini hanya satu di pakai di semua Organization
  settingName String @id @default(uuid())
  inUse Boolean @default(true)
  createdById String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


enum Recurring {
  DAILY
  WEEKLY
  MONTHLY
}

enum SubscriptionPlan {
  TRIAL
  PRO
  PREMIUM
}

model Warehouse {
  id          String   @id @default(uuid())
  name        String   @unique
  location    String?
  description String?
  isActive    Boolean  @default(true)

  docks       Dock[]
  members     User[]   @relation("UserHomeWarehouse")
  bookings    Booking[]
  createdAt   DateTime @default(now())
  userWarehouseAccesses User[]
  organizationName String?
  organization Organization? @relation(fields: [organizationName], references: [name])
}

model Dock {
  id                     String    @id @default(cuid())
  name                   String
  warehouseId            String
  warehouse              Warehouse @relation(fields: [warehouseId], references: [id])

  photos                 String[]
  dockType               String?   // forklift, manual, side, reefer
  supportedVehicleTypes  String[]  // ["CDD","Tronton","Wingbox"]

  maxLength              Int?
  maxWidth               Int?
  maxHeight              Int?

  availableFrom          DateTime
  availableUntil         DateTime

  isActive               Boolean   @default(true)
  priority               Int?

  bookings               Booking[]
  busyTimes              DockBusyTime[]

  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  organizationName String 
  organization Organization @relation(fields: [organizationName], references: [name])
}

model Vehicle {
  id              String  @id @default(cuid())
  brand           String
  jenisKendaraan  String
  plateNumber     String  @unique
  productionYear  Int?

  maxCapacity     String?
  dimensionLength Float?
  dimensionWidth  Float?
  dimensionHeight Float?

  durasiBongkar   Int
  isReefer        Boolean @default(false)
  requiresDock    String? // forklift, manual, side-load, etc.

  driverName String?
  Driver User? @relation(fields: [driverName], references: [username])
  description     String?
  isActive        Boolean @default(true)

  bookings        Booking[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  organizationName String 
  organization Organization @relation(fields: [organizationName], references: [name])
}

model DockBusyTime {
  id        String   @id @default(cuid())
  dockId    String
  from      DateTime
  to        DateTime
  reason    String?
  dock      Dock     @relation(fields: [dockId], references: [id])

  createdAt DateTime @default(now())
}

model Booking {
  id                  String    @id @default(cuid())
  vehicleId           String
  warehouseId         String
  dockId              String?

  arrivalTime         DateTime
  estimatedFinishTime DateTime?
  finishTime          DateTime?
  status              String    // waiting, in_progress, finished, canceled
  notes               String?

  Vehicle             Vehicle   @relation(fields: [vehicleId], references: [id])
  Warehouse           Warehouse @relation(fields: [warehouseId], references: [id])
  Dock                Dock?     @relation(fields: [dockId], references: [id])

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  organizationName String 
  organization Organization @relation(fields: [organizationName], references: [name])
}

model User {
  username         String   @id
  passwordHash     String?  // kalau pakai auth lokal
  description      String?
  isActive         Boolean  @default(true)
  displayName      String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  driverPhone     String?
  driverLicense   String?

  // homeWarehouse = staff biasa (nullable)
  homeWarehouseId  String? 
  homeWarehouse    Warehouse? @relation("UserHomeWarehouse", fields: [homeWarehouseId], references: [id])

  // many-to-many access (admin area)
  warehouseAccess  Warehouse[]

  vehicles Vehicle[]
  
}
